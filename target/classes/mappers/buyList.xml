<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.parker.user.dao.BuyListDAO">
	<!-- 구매내역 -->
	<select id="buyList" parameterType="com.parker.user.vo.BuyListVO"
		resultType="com.parker.user.vo.BuyListVO">
		select *
			from(
        		select 
            		lst.product_image, lst.buy_product, lst.buy_price, lst.buy_number,
               		 lst.BUY_QUANTITY, lst.buy_day, lst.user_number, rownum as rnum
        			from(
          				select
             					p.product_image, b.buy_product, b.buy_price, b.buy_number,
          				      b.BUY_QUANTITY, b.buy_day, u.user_number
        			    from
             				   products_tb p, buy_tb b, users_tb u
             			 where 
               				 u.user_number= b.user_number and p.product_number = b.product_number
               			 
               			 
					<if test="search=='buy_product'">
						and (buy_product Like '%'||#{keyword}||'%')
					</if>
					<if test="search=='buy_day'">
						and (buy_day like '%'||#{keyword}||'%')
					</if>
          			   order by b.buy_number
      					)lst
				)
	</select>
	
	<!-- 전체 리스트 건수 -->
	<select id="buyListCnt" parameterType="com.parker.user.vo.BuyListVO"
		resultType="int">
		 select 
      			nvl(count(1),0) 
  		  from
        			(select 
            				lst.product_image, lst.buy_product, lst.buy_price, lst.buy_number,
               				 lst.BUY_QUANTITY, lst.buy_day, lst.user_number, rownum as rnum
        				from(
          						select
             							p.product_image, b.buy_product, b.buy_price, b.buy_number,
          				     		 b.BUY_QUANTITY, b.buy_day, u.user_number
        			    		from
             				  		 products_tb p, buy_tb b, users_tb u
          			    		where
               							 u.user_number= b.user_number and p.product_number = b.product_number
               							
               						 order by b.buy_number
      						)lst
      				)
	</select>
	
	
 
</mapper>
